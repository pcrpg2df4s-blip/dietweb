<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ö–∞–ª–æ—Ä–∏–π</title>
    <link rel="stylesheet" href="style.css?v=1.1.28">
    <link rel="stylesheet" href="time-picker.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #000000;
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
            transform: translate3d(0, 0, 0) scale(1);
            pointer-events: auto;
            filter: blur(0px);
            backdrop-filter: blur(0px);
        }

        #splash-screen.splash-exit {
            opacity: 0;
            transform: translate3d(0, 0, 0) scale(1.05);
            pointer-events: none;
            filter: blur(15px);
            backdrop-filter: blur(20px);
            visibility: hidden;
        }

        #splash-screen.splash-bg-light {
            background-color: #ffffff;
        }

        .splash-content {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>

<body>
    <div id="splash-screen">
        <video id="splash-video" muted playsinline class="splash-content"></video>
    </div>
    <script>
        // 1. Determine theme instantly
        (function () {
            const theme = localStorage.getItem('theme') || 'dark';
            const splash = document.getElementById('splash-screen');
            const video = document.getElementById('splash-video');

            // 2. Set background color to avoid flashing
            if (theme === 'light') {
                splash.style.backgroundColor = '#ffffff';
                video.src = 'intro-light.mp4';
            } else {
                splash.style.backgroundColor = '#000000';
                video.src = 'intro-dark.mp4';
            }

            // 3. Play immediately
            video.play().catch(() => { /* Auto-play handled */ });

            // 4. Tell Telegram to kill the robot loader NOW
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.expand();
                window.Telegram.WebApp.ready();
            }
        })();
    </script>

    <div class="container">

        <div id="step-1" class="step active">
            <h1>–í–∞—à –ø–æ–ª</h1>
            <p class="subtitle">–≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø–ª–∞–Ω–∞.</p>

            <div class="options-vertical">
                <button class="option-btn" onclick="selectGender('male')">–ú—É–∂—Å–∫–æ–π</button>
                <button class="option-btn" onclick="selectGender('female')">–ñ–µ–Ω—Å–∫–∏–π</button>
            </div>
        </div>

        <div id="step-2" class="step">
            <div class="header-back" onclick="prevStep(1)">‚Üê</div>
            <h1>–°–∫–æ–ª—å–∫–æ —É –≤–∞—Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≤ –Ω–µ–¥–µ–ª—é?</h1>

            <div class="options-vertical">
                <div class="card" onclick="selectActivity(1.2)">
                    <div class="icon">‚¶ø</div>
                    <div class="text">
                        <h3>0-2</h3>
                        <p>–¢—Ä–µ–Ω–∏—Ä—É—é—Å—å —Ä–µ–¥–∫–æ</p>
                    </div>
                </div>
                <div class="card" onclick="selectActivity(1.55)">
                    <div class="icon">‚à¥</div>
                    <div class="text">
                        <h3>3-5</h3>
                        <p>–ù–µ—Å–∫–æ–ª—å–∫–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</p>
                    </div>
                </div>
                <div class="card" onclick="selectActivity(1.725)">
                    <div class="icon">‚Åô</div>
                    <div class="text">
                        <h3>6+</h3>
                        <p>–ê–∫—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Ä—Ç—Å–º–µ–Ω</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="step-3" class="step">
            <div class="header-back" onclick="prevStep(2)">‚Üê</div>
            <h1>–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h1>

            <div class="graph-container">
                <div class="graph-placeholder">
                    <svg viewBox="0 0 300 180" style="width: 100%; height: auto;">
                        <!-- Grid Lines -->
                        <line x1="30" y1="50" x2="270" y2="50" stroke="#eee" stroke-dasharray="4" />
                        <line x1="30" y1="130" x2="270" y2="130" stroke="#eee" stroke-dasharray="4" />

                        <!-- Red Line Area (Traditional Diet) -->
                        <path d="M30,50 C100,50 140,110 160,100 S230,20 270,20 L270,50 L30,50 Z"
                            fill="rgba(255, 77, 77, 0.1)" />
                        <!-- Black Line Area (App) -->
                        <path d="M30,50 C100,50 200,130 270,130 L270,150 L30,150 L30,50 Z" fill="rgba(0, 0, 0, 0.05)" />

                        <!-- Red Line -->
                        <path d="M30,50 C100,50 140,110 160,100 S230,20 270,20" fill="none" stroke="#ff4d4d"
                            stroke-width="3" stroke-linecap="round" />
                        <!-- Black Line -->
                        <path d="M30,50 C100,50 200,130 270,130" fill="none" stroke="#000" stroke-width="3"
                            stroke-linecap="round" />

                        <!-- Points -->
                        <circle cx="30" cy="50" r="5" fill="#fff" stroke="#000" stroke-width="2" />
                        <circle cx="270" cy="130" r="5" fill="#fff" stroke="#000" stroke-width="2" />

                        <!-- Labels -->
                        <text x="30" y="30" fill="#000" font-size="14" font-weight="bold">–í–∞—à –≤–µ—Å</text>

                        <text x="210" y="70" fill="#666" font-size="10">–û–±—ã—á–Ω–∞—è –¥–∏–µ—Ç–∞</text>
                        <text x="50" y="115" fill="#000" font-size="10" font-weight="bold">‚òÖ –ù–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</text>

                        <text x="30" y="170" fill="#999" font-size="10">–ú–µ—Å—è—Ü 1</text>
                        <text x="240" y="170" fill="#999" font-size="10">–ú–µ—Å—è—Ü 6</text>
                    </svg>
                </div>
                <p style="text-align: center; margin-top: 20px; font-size: 14px; color: #555; line-height: 1.4;">
                    <b>80% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</b> —É—Å–ø–µ—à–Ω–æ —É–¥–µ—Ä–∂–∏–≤–∞—é—Ç –≤–µ—Å –∏ –Ω–µ –Ω–∞–±–∏—Ä–∞—é—Ç –µ–≥–æ –æ–±—Ä–∞—Ç–Ω–æ.
                </p>
            </div>

            <button class="main-btn" onclick="nextStep(4)">–î–∞–ª–µ–µ</button>
        </div>

        <div id="step-4" class="step">
            <div class="header-back" onclick="prevStep(3)">‚Üê</div>
            <h1>–í–∞—à —Ä–æ—Å—Ç</h1>
            <p class="subtitle">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–∏–Ω–µ–π–∫—É –¥–ª—è –≤—ã–±–æ—Ä–∞</p>

            <div class="height-picker-content onboarding-ruler">
                <div class="current-height-display">
                    <span id="onboarding-height-val">175</span> <span class="unit">—Å–º</span>
                </div>

                <div class="height-ruler-wrapper">
                    <div class="center-line-horizontal"></div>
                    <div id="onboarding-height-ruler-area" class="height-ruler-area">
                        <div id="onboarding-height-ruler" class="height-ruler">
                            <!-- Ticks generated by JS -->
                        </div>
                    </div>
                </div>
            </div>

            <button class="main-btn" onclick="saveHeightOnboarding()">–î–∞–ª–µ–µ</button>
        </div>

        <div id="step-height-weight" class="step">
            <div class="header-back" onclick="prevStep(4)">‚Üê</div>
            <h1>–í–∞—à –≤–µ—Å</h1>
            <p class="subtitle">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–∏–Ω–µ–π–∫—É –¥–ª—è –≤—ã–±–æ—Ä–∞</p>

            <div class="weight-picker-content onboarding-ruler">
                <div class="current-weight-display">
                    <span id="onboarding-weight-val">75.0</span> <span class="unit">–∫–≥</span>
                </div>

                <div class="ruler-wrapper">
                    <div class="center-line"></div>
                    <div id="onboarding-weight-ruler-area" class="ruler-scroll-area">
                        <div id="onboarding-weight-ruler" class="ruler-ticks">
                            <!-- Ticks generated by JS -->
                        </div>
                    </div>
                </div>
            </div>

            <button class="main-btn" onclick="saveWeightOnboarding()">–î–∞–ª–µ–µ</button>
        </div>

        <div id="step-5" class="step">
            <div class="header-back" onclick="prevStep('height-weight')">‚Üê</div>
            <div class="progress-bar">
                <div class="progress" style="width: 50%;"></div>
            </div>
            <h1>–ö–æ–≥–¥–∞ –≤—ã —Ä–æ–¥–∏–ª–∏—Å—å?</h1>
            <p class="subtitle">–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –Ω–∞–º –æ—Ç–∫–∞–ª–∏–±—Ä–æ–≤–∞—Ç—å –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω.</p>

            <div class="date-spinner-container">
                <div class="date-spinner-wrapper">
                    <div class="spinner-indicator"></div>
                    <div id="spinner-day" class="spinner-col"></div>
                    <div id="spinner-month" class="spinner-col"></div>
                    <div id="spinner-year" class="spinner-col"></div>
                </div>
                <input type="hidden" id="birthdate" value="2000-01-01">
            </div>

            <button class="main-btn" onclick="saveBorn()">–î–∞–ª–µ–µ</button>
        </div>

        <div id="step-6" class="step">
            <div class="header-back" onclick="prevStep(5)">‚Üê</div>
            <div class="progress-bar">
                <div class="progress" style="width: 60%;"></div>
            </div>
            <h1>–ö–∞–∫–∞—è –≤–∞—à–∞ —Ü–µ–ª—å?</h1>
            <p class="subtitle">–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –Ω–∞–º —Å–æ—Å—Ç–∞–≤–∏—Ç—å –ø–ª–∞–Ω –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –∫–∞–ª–æ—Ä–∏–π.</p>

            <div class="options-vertical">
                <button class="option-btn" onclick="selectGoal('lose')">–ü–æ—Ö—É–¥–µ—Ç—å</button>
                <button class="option-btn" onclick="selectGoal('maintain')">–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –≤–µ—Å</button>
                <button class="option-btn" onclick="selectGoal('gain')">–ù–∞–±—Ä–∞—Ç—å –≤–µ—Å</button>
            </div>
        </div>

        <div id="step-7" class="step">
            <div class="header-back" onclick="prevStep(6)">‚Üê</div>
            <div class="progress-bar">
                <div class="progress" style="width: 70%;"></div>
            </div>
            <h1>–ß—Ç–æ –º–µ—à–∞–µ—Ç –≤–∞–º –¥–æ—Å—Ç–∏—á—å —Ü–µ–ª–∏?</h1>

            <div class="options-vertical">
                <div class="card" onclick="selectStopper('consistency')">
                    <div class="icon">üìä</div>
                    <div class="text">
                        <h3>–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã</h3>
                    </div>
                </div>
                <div class="card" onclick="selectStopper('eating_habits')">
                    <div class="icon">üçî</div>
                    <div class="text">
                        <h3>–ù–µ–∑–¥–æ—Ä–æ–≤—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏ –≤ –µ–¥–µ</h3>
                    </div>
                </div>
                <div class="card" onclick="selectStopper('support')">
                    <div class="icon">ü§ù</div>
                    <div class="text">
                        <h3>–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏</h3>
                    </div>
                </div>
                <div class="card" onclick="selectStopper('schedule')">
                    <div class="icon">üìÖ</div>
                    <div class="text">
                        <h3>–ü–ª–æ—Ç–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫</h3>
                    </div>
                </div>
                <div class="card" onclick="selectStopper('inspiration')">
                    <div class="icon">üí°</div>
                    <div class="text">
                        <h3>–ù–µ—Ç –∏–¥–µ–π –¥–ª—è –±–ª—é–¥</h3>
                    </div>
                </div>
            </div>
        </div>

        <div id="step-8" class="step">
            <div class="header-back" onclick="prevStep(7)">‚Üê</div>
            <div class="progress-bar">
                <div class="progress" style="width: 80%;"></div>
            </div>
            <h1>–í—ã –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–µ—Ç–µ—Å—å –¥–∏–µ—Ç—ã?</h1>

            <div class="options-vertical">
                <div class="card" onclick="selectDiet('classic')">
                    <div class="icon">üçó</div>
                    <div class="text">
                        <h3>–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è</h3>
                    </div>
                </div>
                <div class="card" onclick="selectDiet('pescatarian')">
                    <div class="icon">üêü</div>
                    <div class="text">
                        <h3>–ü–µ—Å–∫–µ—Ç–∞—Ä–∏–∞–Ω—Å—Ç–≤–æ</h3>
                    </div>
                </div>
                <div class="card" onclick="selectDiet('vegetarian')">
                    <div class="icon">ü•¶</div>
                    <div class="text">
                        <h3>–í–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å—Ç–≤–æ</h3>
                    </div>
                </div>
            </div>
        </div>

        <div id="step-9" class="step">
            <div class="header-back" onclick="prevStep(8)">‚Üê</div>
            <div class="progress-bar">
                <div class="progress" style="width: 90%;"></div>
            </div>
            <h1>–ß–µ–≥–æ –±—ã –≤—ã —Ö–æ—Ç–µ–ª–∏ –¥–æ—Å—Ç–∏—á—å?</h1>

            <div class="options-vertical">
                <div class="card" onclick="selectAccomplish('healthier')">
                    <div class="icon">üçé</div>
                    <div class="text">
                        <h3>–ü–∏—Ç–∞—Ç—å—Å—è –∏ –∂–∏—Ç—å –∑–¥–æ—Ä–æ–≤–µ–µ</h3>
                    </div>
                </div>
                <div class="card" onclick="selectAccomplish('energy')">
                    <div class="icon">‚òÄÔ∏è</div>
                    <div class="text">
                        <h3>–£–ª—É—á—à–∏—Ç—å —ç–Ω–µ—Ä–≥–∏—é –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</h3>
                    </div>
                </div>
                <div class="card" onclick="selectAccomplish('motivated')">
                    <div class="icon">üí™</div>
                    <div class="text">
                        <h3>–û—Å—Ç–∞–≤–∞—Ç—å—Å—è –º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–º</h3>
                    </div>
                </div>
                <div class="card" onclick="selectAccomplish('body')">
                    <div class="icon">üßò</div>
                    <div class="text">
                        <h3>–ß—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Å–µ–±—è –ª—É—á—à–µ</h3>
                    </div>
                </div>
            </div>
        </div>

        <div id="step-10" class="step">
            <div class="loading-container">
                <div class="percentage" id="load-percentage">0%</div>
                <h1 id="loading-title">–ì–æ—Ç–æ–≤–∏–º –≤–∞—à –ø–ª–∞–Ω</h1>

                <div class="loading-bar-wrapper">
                    <div class="loading-bar-fill" id="load-progress"></div>
                </div>

                <p class="loading-status" id="load-status">–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ...</p>

                <div class="recommendation-card">
                    <h3>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è:</h3>
                    <ul class="check-list">
                        <li id="check-calories">
                            <span>–ö–∞–ª–æ—Ä–∏–∏</span>
                            <div class="check-icon">‚úì</div>
                        </li>
                        <li id="check-carbs">
                            <span>–£–≥–ª–µ–≤–æ–¥—ã</span>
                            <div class="check-icon">‚úì</div>
                        </li>
                        <li id="check-protein">
                            <span>–ë–µ–ª–∫–∏</span>
                            <div class="check-icon">‚úì</div>
                        </li>
                        <li id="check-fats">
                            <span>–ñ–∏—Ä—ã</span>
                            <div class="check-icon">‚úì</div>
                        </li>
                        <li id="check-health">
                            <span>–ò–Ω–¥–µ–∫—Å –∑–¥–æ—Ä–æ–≤—å—è</span>
                            <div class="check-icon">‚úì</div>
                        </li>
                    </ul>
                </div>
            </div>

            <div id="final-btn-container" class="cinematic-reveal">
                <button id="final-btn" class="main-btn" onclick="showResults()">–ü–æ–ª—É—á–∏—Ç—å –ø–ª–∞–Ω</button>
            </div>
        </div>

        <div id="step-11" class="step">
            <div class="result-header">
                <div class="check-circle-big">‚úì</div>
                <h1>–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!<br>–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –≥–æ—Ç–æ–≤!</h1>
                <p class="subtitle" id="goal-text">–í–∞—à–∞ —Ü–µ–ª—å: –ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ –≤–µ—Å–∞</p>
                <div class="target-weight-badge" id="target-weight">75 –∫–≥</div>
            </div>

            <div class="daily-recommendations">
                <div class="section-title">
                    <h2>–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –Ω–æ—Ä–º–∞</h2>
                    <span>–ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è</span>
                </div>

                <div class="macros-grid">
                    <div class="macro-card">
                        <div class="macro-info">
                            <span class="macro-icon">üî•</span>
                            <span class="macro-name">–ö–∞–ª–æ—Ä–∏–∏</span>
                        </div>
                        <div class="progress-ring-container">
                            <svg class="progress-ring" width="100" height="100">
                                <circle class="progress-ring__circle-bg ring-track" stroke-width="8" fill="transparent"
                                    r="40" cx="50" cy="50" />
                                <circle id="ring-calories" class="progress-ring__circle ring-progress" stroke-width="8"
                                    fill="transparent" r="40" cx="50" cy="50" />
                            </svg>
                            <div class="macro-value" id="res-calories">2062</div>
                        </div>
                    </div>

                    <div class="macro-card">
                        <div class="macro-info">
                            <span class="macro-icon">üåæ</span>
                            <span class="macro-name">–£–≥–ª–µ–≤–æ–¥—ã</span>
                        </div>
                        <div class="progress-ring-container">
                            <svg class="progress-ring" width="100" height="100">
                                <circle class="progress-ring__circle-bg ring-track" stroke-width="8" fill="transparent"
                                    r="40" cx="50" cy="50" />
                                <circle id="ring-carbs" class="progress-ring__circle carbs" stroke="#e5b68b"
                                    stroke-width="8" fill="transparent" r="40" cx="50" cy="50" />
                            </svg>
                            <div class="macro-value" id="res-carbs">234–≥</div>
                        </div>
                    </div>

                    <div class="macro-card">
                        <div class="macro-info">
                            <span class="macro-icon">ü•©</span>
                            <span class="macro-name">–ë–µ–ª–∫–∏</span>
                        </div>
                        <div class="progress-ring-container">
                            <svg class="progress-ring" width="100" height="100">
                                <circle class="progress-ring__circle-bg ring-track" stroke-width="8" fill="transparent"
                                    r="40" cx="50" cy="50" />
                                <circle id="ring-protein" class="progress-ring__circle protein" stroke="#e58b8b"
                                    stroke-width="8" fill="transparent" r="40" cx="50" cy="50" />
                            </svg>
                            <div class="macro-value" id="res-protein">152–≥</div>
                        </div>
                    </div>

                    <div class="macro-card">
                        <div class="macro-info">
                            <span class="macro-icon">ü•ë</span>
                            <span class="macro-name">–ñ–∏—Ä—ã</span>
                        </div>
                        <div class="progress-ring-container">
                            <svg class="progress-ring" width="100" height="100">
                                <circle class="progress-ring__circle-bg ring-track" stroke-width="8" fill="transparent"
                                    r="40" cx="50" cy="50" />
                                <circle id="ring-fats" class="progress-ring__circle fats" stroke="#8bb6e5"
                                    stroke-width="8" fill="transparent" r="40" cx="50" cy="50" />
                            </svg>
                            <div class="macro-value" id="res-fats">57–≥</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="how-to-reach">
                <h2>–ö–∞–∫ –¥–æ—Å—Ç–∏—á—å —Ü–µ–ª–∏:</h2>
                <div class="tips-container" id="ai-tips">
                    <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ AI -->
                    <div class="tip-item">
                        <div class="tip-icon">üíñ</div>
                        <div class="tip-text">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω–¥–µ–∫—Å –∑–¥–æ—Ä–æ–≤—å—è –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞</div>
                    </div>
                    <div class="tip-item">
                        <div class="tip-icon">ü•ë</div>
                        <div class="tip-text">–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –∫–∞–∂–¥—ã–π –ø—Ä–∏–µ–º –ø–∏—â–∏</div>
                    </div>
                    <div class="tip-item">
                        <div class="tip-icon">‚è≤Ô∏è</div>
                        <div class="tip-text">–°–ª–µ–¥—É–π—Ç–µ –¥–Ω–µ–≤–Ω–æ–π –Ω–æ—Ä–º–µ –∫–∞–ª–æ—Ä–∏–π</div>
                    </div>
                </div>
            </div>

            <button class="main-btn" onclick="goToHome()">–ù–∞—á–∞—Ç—å!</button>
        </div>

        <div id="step-12" class="step step-home">
            <div class="home-page">
                <div id="week-calendar" class="calendar-container"></div>


                <div class="main-calorie-card">
                    <div id="streak-badge" class="streak-badge">
                        <span class="streak-icon">üî•</span>
                        <span id="streak-count">0</span>
                    </div>
                    <div class="calorie-left">
                        <h2 id="home-calories-left">0</h2>
                        <span id="home-calories-total">–ö–∫–∞–ª –æ—Å—Ç–∞–ª–æ—Å—å</span>
                    </div>
                    <div class="calorie-ring-container">
                        <svg viewBox="0 0 100 100" class="large-ring">
                            <circle class="ring-track" cx="50" cy="50" r="45" fill="none" stroke-width="8"></circle>
                            <circle id="home-ring-calories" class="ring-progress" cx="50" cy="50" r="45" fill="none"
                                stroke-width="8" stroke-dasharray="282.7" stroke-dashoffset="282.7"
                                stroke-linecap="round"></circle>
                        </svg>
                        <div class="ring-icon" style="filter: grayscale(1) brightness(0);">üî•</div>
                    </div>
                </div>

                <div class="macros-home-grid">
                    <div class="macro-home-card">
                        <div class="macro-home-top">
                            <div class="macro-home-value"><span id="home-protein-eaten">0</span>–≥</div>
                            <div class="macro-home-label">–ë–µ–ª–∫–∏</div>
                        </div>
                        <div class="macro-home-ring">
                            <svg viewBox="0 0 36 36">
                                <circle class="ring-track" cx="18" cy="18" r="16" fill="none" stroke-width="3"></circle>
                                <circle id="home-ring-protein" cx="18" cy="18" r="16" fill="none" stroke="#e58b8b"
                                    stroke-width="3" stroke-dasharray="100 100" stroke-dashoffset="100"
                                    stroke-linecap="round"></circle>
                            </svg>
                            <div class="macro-mini-icon">ü•©</div>
                        </div>
                    </div>
                    <div class="macro-home-card">
                        <div class="macro-home-top">
                            <div class="macro-home-value"><span id="home-carbs-eaten">0</span>–≥</div>
                            <div class="macro-home-label">–£–≥–ª–µ–≤–æ–¥—ã</div>
                        </div>
                        <div class="macro-home-ring">
                            <svg viewBox="0 0 36 36">
                                <circle class="ring-track" cx="18" cy="18" r="16" fill="none" stroke-width="3"></circle>
                                <circle id="home-ring-carbs" cx="18" cy="18" r="16" fill="none" stroke="#e5b68b"
                                    stroke-width="3" stroke-dasharray="100 100" stroke-dashoffset="100"
                                    stroke-linecap="round"></circle>
                            </svg>
                            <div class="macro-mini-icon">üåæ</div>
                        </div>
                    </div>
                    <div class="macro-home-card">
                        <div class="macro-home-top">
                            <div class="macro-home-value"><span id="home-fats-eaten">0</span>–≥</div>
                            <div class="macro-home-label">–ñ–∏—Ä—ã</div>
                        </div>
                        <div class="macro-home-ring">
                            <svg viewBox="0 0 36 36">
                                <circle class="ring-track" cx="18" cy="18" r="16" fill="none" stroke-width="3"></circle>
                                <circle id="home-ring-fats" cx="18" cy="18" r="16" fill="none" stroke="#8bb6e5"
                                    stroke-width="3" stroke-dasharray="100 100" stroke-dashoffset="100"
                                    stroke-linecap="round"></circle>
                            </svg>
                            <div class="macro-mini-icon">ü•ë</div>
                        </div>
                    </div>
                </div>

                <div class="recent-uploads">
                    <h3>–ù–µ–¥–∞–≤–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ</h3>
                    <div id="food-list" class="food-list">
                        <div class="empty-state">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π. –ù–∞–∂–º–∏—Ç–µ +, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å.</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="camera-screen" class="hidden">
            <video id="video-preview" autoplay playsinline muted></video>
            <div id="camera-hint"></div>
            <div id="camera-permission-ui">
                <p id="camera-status-text">–†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ, —á—Ç–æ–±—ã —Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –µ–¥—É üì∏</p>
                <button id="retry-camera-btn" class="secondary-btn hidden" onclick="openCamera()">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å
                    —Å–Ω–æ–≤–∞</button>
            </div>

            <div id="analysis-overlay" class="hidden">
                <div id="analysis-card">
                    <h3>–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º...</h3>
                    <div class="progress-ring-container">
                        <svg class="progress-ring" width="120" height="120">
                            <circle class="progress-ring__circle--track ring-track" stroke-width="8" fill="transparent"
                                r="52" cx="60" cy="60" />
                            <circle class="progress-ring__circle--progress ring-progress" stroke-width="8"
                                fill="transparent" r="52" cx="60" cy="60" id="analysis-progress-circle" />
                        </svg>
                        <div class="progress-text-container">
                            <span id="analysis-percent-val">0</span><span>%</span>
                        </div>
                    </div>
                    <p class="analysis-status">–†–∞—Å–ø–æ–∑–Ω–∞–µ–º –µ–¥—É –∏ —Å—á–∏—Ç–∞–µ–º –∫–∞–ª–æ—Ä–∏–∏</p>
                </div>
            </div>

            <div class="camera-overlay">
                <div class="focus-corners"></div>
            </div>
            <div class="camera-controls">
                <input type="file" id="gallery-input" accept="image/*" style="display: none;">
                <div class="camera-close" onclick="closeCamera()">‚úï</div>
                <div id="shutter-btn" onclick="takePhoto()"></div>
                <div id="gallery-btn" class="icon-btn">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                        <polyline points="21 15 16 10 5 21"></polyline>
                    </svg>
                </div>
            </div>
            <canvas id="camera-canvas" style="display:none;"></canvas>
        </div>

        <div id="step-14" class="step hidden">
            <!-- Legacy analysis step hidden, replaced by overlay inside camera-screen -->
            <img id="analyzed-img" src="" style="display:none;">
        </div>

        <div id="step-15" class="step">
            <div class="progress-page">
                <!-- –ù–æ–≤—ã–π –±–ª–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–µ—Å–æ–º –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º -->
                <div class="weight-progress-grid">
                    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ 1: –ú–æ–π –≤–µ—Å -->
                    <div class="weight-card widget-card">
                        <div class="widget-header">–ú–æ–π –≤–µ—Å</div>
                        <div class="widget-main weight-display">
                            <span id="stats-current-weight">--</span>
                            <span class="widget-unit">–∫–≥</span>
                        </div>
                        <div style="height: 8px;"></div>
                        <div class="widget-action-btn" onclick="logNewWeight()">
                            <span>–£–∫–∞–∑–∞—Ç—å –≤–µ—Å</span>
                            <span class="action-arrow">‚Üí</span>
                        </div>
                    </div>

                    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ 2: –°—Ç—Ä–∏–∫ -->
                    <div class="streak-card widget-card">
                        <div class="widget-header">üî• –°—Ç—Ä–∏–∫</div>
                        <div class="widget-main">
                            <span id="stats-streak-count">0</span>
                        </div>
                        <div class="streak-dots" id="stats-streak-dots">
                            <!-- 7 –∫—Ä—É–∂–æ—á–∫–æ–≤ -->
                            <div class="streak-dot"></div>
                            <div class="streak-dot"></div>
                            <div class="streak-dot"></div>
                            <div class="streak-dot"></div>
                            <div class="streak-dot"></div>
                            <div class="streak-dot"></div>
                            <div class="streak-dot"></div>
                        </div>
                    </div>

                    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ 3: –î–∏–Ω–∞–º–∏–∫–∞ -->
                    <div class="dynamics-card widget-card">
                        <div class="widget-header">–î–∏–Ω–∞–º–∏–∫–∞</div>
                        <div class="weight-chart-container">
                            <canvas id="weightHistoryChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="progress-card chart-card">
                    <div class="chart-header">
                        <div class="chart-title">–ö–∞–ª–æ—Ä–∏–∏</div>
                        <div class="chart-main-value">
                            <span id="progress-total-calories">0</span>
                            <span class="chart-unit">–∫–∫–∞–ª</span>
                        </div>
                    </div>

                    <div class="chart-canvas-container">
                        <canvas id="totalCaloriesChart"></canvas>
                    </div>

                    <div class="chart-legend-custom">
                        <div class="legend-item">
                            <span class="legend-dot protein"></span>
                            <span class="legend-label">–ë–µ–ª–∫–∏</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-dot carbs"></span>
                            <span class="legend-label">–£–≥–ª–µ–≤–æ–¥—ã</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-dot fats"></span>
                            <span class="legend-label">–ñ–∏—Ä—ã</span>
                        </div>
                    </div>
                </div>

                <div class="progress-card bmi-card">
                    <div class="bmi-header">
                        <h3>–í–∞—à –ò–ú–¢</h3>
                        <div class="help-icon bmi-info-icon" style="cursor: pointer;">?</div>
                    </div>

                    <div class="bmi-value-row">
                        <span id="bmi-number" class="bmi-number">0.0</span>
                        <div class="bmi-status-box">
                            <span>–í–∞—à –≤–µ—Å:</span>
                            <span id="bmi-status-text" class="status-badge">–ù–æ—Ä–º–∞</span>
                        </div>
                    </div>

                    <div class="bmi-scale-container">
                        <div class="bmi-scale-gradient"></div>
                        <div id="bmi-pointer" class="bmi-pointer"></div>
                    </div>

                    <div class="bmi-labels">
                        <div class="label-item">
                            <span class="dot underweight"></span>
                            <span>–î–µ—Ñ–∏—Ü–∏—Ç</span>
                        </div>
                        <div class="label-item">
                            <span class="dot healthy"></span>
                            <span>–ù–æ—Ä–º–∞</span>
                        </div>
                        <div class="label-item">
                            <span class="dot overweight"></span>
                            <span>–õ–∏—à–Ω–∏–π</span>
                        </div>
                        <div class="label-item">
                            <span class="dot obese"></span>
                            <span>–û–∂–∏—Ä–µ–Ω–∏–µ</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="step-16" class="step">
            <div class="settings-page-new">

                <div class="profile-header-center">
                    <div class="avatar-large-container" id="settings-avatar"></div>
                    <h2 id="settings-name">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
                    <div class="user-status-badge">Pro User</div>
                </div>

                <div class="settings-group-label">–ú–æ–∏ –¥–∞–Ω–Ω—ã–µ</div>
                <div class="settings-list-container">
                    <div class="settings-row" onclick="editSetting('activity')">
                        <span class="row-label">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</span>
                        <div class="row-value-group">
                            <span id="set-activity-text">-</span>
                            <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </div>
                    </div>
                    <div class="settings-row" onclick="openWeightRuler()">
                        <span class="row-label">–í–µ—Å</span>
                        <div class="row-value-group">
                            <span id="set-weight-text">-</span>
                            <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </div>
                    </div>
                    <div class="settings-row" onclick="editSetting('goal')">
                        <span class="row-label">–¶–µ–ª—å</span>
                        <div class="row-value-group">
                            <span id="set-goal-text">-</span>
                            <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </div>
                    </div>
                    <div class="settings-row no-border" onclick="editSetting('height')">
                        <span class="row-label">–†–æ—Å—Ç</span>
                        <div class="row-value-group">
                            <span id="set-height-text">-</span>
                            <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="settings-group-label">–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</div>
                <div class="settings-list-container">
                    <div class="settings-row">
                        <span class="row-label">–¢–µ–º–Ω–∞—è —Ç–µ–º–∞</span>
                        <div class="row-value-group">
                            <label class="ios-switch">
                                <input type="checkbox" id="theme-toggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="settings-row no-border" onclick="openSubscriptionModal()">
                        <span class="row-label">–ü–æ–¥–ø–∏—Å–∫–∞</span>
                        <div class="row-value-group">
                            <span style="color: var(--text-primary); font-weight: 700;">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
                            <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="settings-group-label">–ë–æ–Ω—É—Å—ã</div>
                <div class="referral-box">
                    <div class="referral-icon">üéÅ</div>
                    <h3>–ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–≥–∞</h3>
                    <p>–ü–æ–ª—É—á–∏ –¥–æ—Å—Ç—É–ø –∫ –Ω–æ–≤—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º –∑–∞ –∫–∞–∂–¥–æ–≥–æ –¥—Ä—É–≥–∞.</p>
                    <button class="referral-btn">–ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É</button>
                </div>

                <div class="settings-actions" style="margin-top: 30px;">
                    <button class="settings-btn danger-btn" onclick="resetAppData()">–°–±—Ä–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
                </div>

                <div style="height: 100px;"></div>
            </div>
        </div>

    </div>
    <div id="global-tab-bar" class="tab-bar" style="display: none;">
        <div id="tab-home" class="tab-item active" onclick="nextStep(12)">
            <div class="tab-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                    <polyline points="9 22 9 12 15 12 15 22" />
                </svg>
            </div>
        </div>
        <div id="tab-progress" class="tab-item" onclick="updateProgressPage()">
            <div class="tab-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="20" x2="18" y2="10" />
                    <line x1="12" y1="20" x2="12" y2="4" />
                    <line x1="6" y1="20" x2="6" y2="14" />
                </svg>
            </div>
        </div>
        <div id="tab-settings" class="tab-item" onclick="openSettings()">
            <div class="tab-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="3" />
                    <path
                        d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                </svg>
            </div>
        </div>
        <div id="add-options-menu" class="hidden">
            <button id="option-check-btn" class="menu-option-btn">
                <span class="option-label">–ü—Ä–æ–≤–µ—Ä–∫–∞</span>
                <div class="option-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path
                            d="M3 7V5a2 2 0 012-2h2m10 0h2a2 2 0 012 2v2m0 10v2a2 2 0 01-2 2h-2M7 21H5a2 2 0 01-2-2v-2M8 7v10M12 7v10M16 7v10" />
                    </svg>
                </div>
            </button>
            <button id="option-cooking-btn" class="menu-option-btn">
                <span class="option-label">–ì–æ—Ç–æ–≤–∫–∞</span>
                <div class="option-icon">
                    <i class="fa-solid fa-kitchen-set" style="color: white; font-size: 20px;"></i>
                </div>
            </button>
            <button id="option-text-btn" class="menu-option-btn">
                <span class="option-label">–í—Ä—É—á–Ω—É—é</span>
                <div class="option-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                        <line x1="6" y1="8" x2="6" y2="8"></line>
                        <line x1="10" y1="8" x2="10" y2="8"></line>
                        <line x1="14" y1="8" x2="14" y2="8"></line>
                        <line x1="18" y1="8" x2="18" y2="8"></line>
                        <line x1="6" y1="12" x2="6" y2="12"></line>
                        <line x1="10" y1="12" x2="10" y2="12"></line>
                        <line x1="14" y1="12" x2="14" y2="12"></line>
                        <line x1="18" y1="12" x2="18" y2="12"></line>
                        <line x1="8" y1="16" x2="16" y2="16"></line>
                    </svg>
                </div>
            </button>
            <button id="option-camera-btn" class="menu-option-btn">
                <span class="option-label">–§–æ—Ç–æ</span>
                <div class="option-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z">
                        </path>
                        <circle cx="12" cy="13" r="4"></circle>
                    </svg>
                </div>
            </button>
        </div>
        <div id="add-btn-main" class="add-btn-main">
            <svg class="add-btn-icon" width="32" height="32" viewBox="0 0 24 24" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <path d="M12 4V20M4 12H20" stroke="currentColor" stroke-width="3" stroke-linecap="round"
                    stroke-linejoin="round" />
            </svg>
        </div>
        <div id="app-version-label"
            style="position: absolute; bottom: 2px; width: 100%; text-align: center; font-size: 8px; color: #ccc; pointer-events: none;">
            v1.2.0</div>
    </div>

    <div id="bmi-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3>–§–æ—Ä–º—É–ª–∞ –ò–ú–¢</h3>
            <div class="formula-box">
                <span class="formula-text">–ò–ú–¢ = –í–µ—Å (–∫–≥) / –†–æ—Å—Ç (–º)¬≤</span>
            </div>
            <p class="modal-desc">–ò–Ω–¥–µ–∫—Å –º–∞—Å—Å—ã —Ç–µ–ª–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –¥–µ–ª–µ–Ω–∏–µ–º –≤–µ—Å–∞ –≤ –∫–∏–ª–æ–≥—Ä–∞–º–º–∞—Ö –Ω–∞ –∫–≤–∞–¥—Ä–∞—Ç —Ä–æ—Å—Ç–∞ –≤
                –º–µ—Ç—Ä–∞—Ö.</p>
            <button id="close-bmi-modal" class="primary-btn small">–ü–æ–Ω—è—Ç–Ω–æ</button>
        </div>
    </div>

    <div id="error-modal" class="modal hidden">
        <div class="modal-content">
            <h3>–ï–¥—ã –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ ü§∑‚Äç‚ôÇÔ∏è</h3>
            <p>–ò–ò –Ω–µ —Å–º–æ–≥ —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –±–ª—é–¥–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Å–Ω—è—Ç—å –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –≤—Ä—É—á–Ω—É—é.</p>
            <div class="modal-buttons">
                <button id="manual-add-btn" class="primary-btn">–î–æ–±–∞–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é</button>
                <button id="error-close-btn" class="secondary-btn">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <div id="manual-add-modal" class="modal hidden">
        <div class="modal-content">
            <h3 id="manual-modal-title">–î–æ–±–∞–≤–∏—Ç—å –±–ª—é–¥–æ</h3>
            <input type="hidden" id="edit-food-id">
            <input type="text" id="manual-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" class="modal-input">
            <input type="number" id="manual-calories" placeholder="–ö–∫–∞–ª (–µ—Å–ª–∏ –∑–Ω–∞–µ—Ç–µ)" class="modal-input">
            <input type="text" id="manual-time" class="modal-input" placeholder="–í—Ä–µ–º—è" readonly>

            <div class="manual-macros-inputs"
                style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                <input type="number" id="manual-protein" placeholder="–ë" class="modal-input" style="margin-bottom: 0;">
                <input type="number" id="manual-fat" placeholder="–ñ" class="modal-input" style="margin-bottom: 0;">
                <input type="number" id="manual-carbs" placeholder="–£" class="modal-input" style="margin-bottom: 0;">
            </div>

            <textarea id="manual-description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" class="modal-input"
                style="min-height: 60px; resize: vertical; font-family: inherit;"></textarea>

            <div class="modal-buttons">
                <button id="save-manual-btn" class="primary-btn">–î–æ–±–∞–≤–∏—Ç—å</button>
                <button id="cancel-manual-btn" class="secondary-btn">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- Custom Time Picker -->
    <div id="time-picker-overlay" class="time-picker-overlay hidden">
        <div class="time-picker-content">
            <div class="time-picker-header">
                <button id="time-picker-cancel" class="time-picker-btn">–û—Ç–º–µ–Ω–∞</button>
                <span class="time-picker-title">–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è</span>
                <button id="time-picker-done" class="time-picker-btn time-picker-done-btn">–ì–æ—Ç–æ–≤–æ</button>
            </div>
            <div class="time-picker-body">
                <div class="time-picker-columns">
                    <div class="time-picker-column" id="hours-column">
                        <!-- Hours will be generated by JS -->
                    </div>
                    <div class="time-picker-separator">:</div>
                    <div class="time-picker-column" id="minutes-column">
                        <!-- Minutes will be generated by JS -->
                    </div>
                </div>
                <div class="time-picker-selection-indicator"></div>
            </div>
        </div>
    </div>

    <div id="ai-loader" class="loader-overlay hidden">
        <div class="loader-content">
            <div class="loader-icon">‚ú®</div>
            <h3 id="loader-title">–ê–Ω–∞–ª–∏–∑ –µ–¥—ã...</h3>
            <div class="progress-container">
                <div class="progress-bar-fill"></div>
            </div>
            <p id="loader-status">–†–∞—Å–ø–æ–∑–Ω–∞–µ–º –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã</p>
        </div>
    </div>

    <div id="recipe-modal" class="modal hidden">
        <div class="modal-content recipe-content">
            <h2 id="recipe-title">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
            <p class="recipe-macros">–ö–∫–∞–ª: <span id="recipe-cal">0</span> (–ë: <span id="recipe-p">0</span>, –ñ: <span
                    id="recipe-f">0</span>, –£: <span id="recipe-c">0</span>)</p>
            <hr>
            <div id="recipe-instructions" class="recipe-text"></div>

            <div class="modal-actions">
                <button id="save-recipe-btn" class="primary-btn icon-btn-wide">–î–∞, –∑–∞–ø–∏—Å–∞—Ç—å</button>
                <button id="cancel-recipe-btn" class="secondary-btn">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <div id="check-result-modal" class="modal hidden">
        <div class="modal-content recipe-content">
            <div class="modal-flex-container">
                <h3 id="product-name-display"></h3>
                <div class="check-score-container" style="flex-shrink: 0; margin-top: 10px;">
                    <div class="score-bar-wrapper">
                        <div id="check-score-fill" class="score-bar-fill" style="width: 0%;"></div>
                    </div>
                    <div class="score-value"><span id="check-score-number">0</span>/100</div>
                </div>
                <div class="modal-body-wrapper">
                    <div class="modal-body-scroll">
                        <p id="check-summary" class="recipe-text"></p>
                    </div>
                    <div class="fade-out-overlay"></div>
                </div>
                <div class="modal-actions" style="flex-shrink: 0;">
                    <button id="recheck-btn" class="main-btn" style="margin-top: 0;">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–Ω–æ–≤–∞</button>
                    <button id="close-check-btn" class="secondary-btn"
                        style="width: 100%; margin-top: 10px; border-radius: 30px; padding: 16px;">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Edit Modal -->
    <div id="settings-edit-modal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 360px; padding: 25px;">
            <h3 id="edit-modal-title" style="margin-bottom: 15px;">–ò–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</h3>
            <div id="edit-input-container" style="margin: 15px 0;">
                <!-- Input or Select will be injected here -->
            </div>
            <div class="modal-buttons" style="display: flex; flex-direction: column; gap: 12px; margin-top: 10px;">
                <button id="save-edit-btn"
                    style="background-color: #000000; color: #ffffff; border: none; border-radius: 30px; padding: 14px 0; width: 100%; font-weight: 700; font-size: 16px; cursor: pointer;">–î–æ–±–∞–≤–∏—Ç—å</button>
                <button id="cancel-edit-btn"
                    style="background: transparent; border: 2px solid #000; color: #000; border-radius: 30px; padding: 14px 0; width: 100%; font-weight: 700; font-size: 16px; cursor: pointer;">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <div id="delete-confirm-modal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 320px; padding: 30px; text-align: center;">
            <div style="font-size: 40px; margin-bottom: 15px;">üóëÔ∏è</div>
            <h3 style="margin-bottom: 10px;">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —É–¥–∞–ª–µ–Ω–∏–µ</h3>
            <p style="color: var(--text-secondary); font-size: 15px; margin-bottom: 25px; line-height: 1.4;">–í—ã
                –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ–¥—É–∫—Ç?</p>
            <div class="modal-buttons" style="display: flex; flex-direction: column; gap: 12px;">
                <button id="confirm-delete-btn"
                    style="background-color: #ff3b30; color: #ffffff; border: none; border-radius: 30px; padding: 16px 0; width: 100%; font-weight: 700; font-size: 16px; cursor: pointer;">–£–¥–∞–ª–∏—Ç—å</button>
                <button id="cancel-delete-btn"
                    style="background: transparent; border: none; color: var(--text-primary); border-radius: 30px; padding: 10px 0; width: 100%; font-weight: 600; font-size: 16px; cursor: pointer;">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <div id="weight-modal" class="full-screen-modal hidden">
        <div class="modal-header">
            <button id="close-weight-modal" class="icon-btn">‚úï</button>
            <span>–ò–∑–º–µ–Ω–∏—Ç—å –≤–µ—Å</span>
            <div style="width: 24px"></div>
        </div>

        <div class="weight-picker-content onboarding-ruler">
            <div class="current-weight-display">
                <span id="settings-weight-val">75.0</span> <span class="unit">–∫–≥</span>
            </div>

            <div class="ruler-wrapper">
                <div class="center-line"></div>
                <div id="settings-weight-ruler-area" class="ruler-scroll-area">
                    <div id="settings-weight-ruler" class="ruler-ticks">
                        <!-- Ticks generated by JS -->
                    </div>
                </div>
            </div>
        </div>

        <button id="save-weight-btn" class="main-btn" style="margin: 20px; width: calc(100% - 40px);">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å
            –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
    </div>

    <div id="height-modal" class="full-screen-modal hidden">
        <div class="modal-header">
            <button id="close-height-modal" class="icon-btn">‚úï</button>
            <span>–ò–∑–º–µ–Ω–∏—Ç—å —Ä–æ—Å—Ç</span>
            <div style="width: 24px"></div>
        </div>

        <div class="height-picker-content onboarding-ruler">
            <div class="current-height-display">
                <span id="settings-height-val">175</span> <span class="unit">—Å–º</span>
            </div>

            <div class="height-ruler-wrapper">
                <div class="center-line-horizontal"></div>
                <div id="settings-height-ruler-area" class="height-ruler-area">
                    <div id="settings-height-ruler" class="height-ruler">
                        <!-- Ticks generated by JS -->
                    </div>
                </div>
            </div>
        </div>

        <button id="save-height-btn" class="main-btn" style="margin: 20px; width: calc(100% - 40px);">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å
            –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
    </div>

    <div id="reset-confirm-modal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 320px; padding: 30px; text-align: center;">
            <div style="font-size: 40px; margin-bottom: 15px;">‚ö†Ô∏è</div>
            <h3>–í—ã —É–≤–µ—Ä–µ–Ω—ã?</h3>
            <p style="color: var(--text-secondary); font-size: 15px; margin-bottom: 25px; line-height: 1.4;">–í—Å–µ –≤–∞—à–∏
                –¥–∞–Ω–Ω—ã–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ.</p>
            <div class="modal-buttons" style="display: flex; flex-direction: column; gap: 12px;">
                <button id="confirm-reset-btn" class="btn-danger-filled">–î–∞</button>
                <button id="cancel-reset-btn" class="btn-outline">–ù–µ—Ç</button>
            </div>
        </div>
    </div>



    <!-- FINAL MODAL (TASK REPLACEMENT) -->
    <div id="final-food-modal" class="modal-overlay hidden">
        <div class="food-modal-sheet_final">
            <!-- Hero Image -->
            <div class="hero-header_final">
                <img src="https://images.unsplash.com/photo-1585109649139-366815a0d713?q=80&w=1000&auto=format&fit=crop"
                    class="hero-img_final" alt="Food">
                <button class="close-btn_final"
                    onclick="document.getElementById('final-food-modal').classList.add('hidden')">‚úï</button>
            </div>

            <!-- Scrollable Content -->
            <div class="content-sheet_final">
                <h1 style="color: white; margin-bottom: 24px;">Bagel with Cream Cheese</h1>

                <!-- Macro Cards -->
                <div class="macro-card_final">
                    <div class="ring-container_final">
                        <span class="ring-emoji_final">üî•</span>
                        <svg class="svg-ring_final">
                            <circle class="ring-bg_final" cx="27" cy="27" r="22"></circle>
                            <circle class="ring-fg_final" cx="27" cy="27" r="22" stroke="#FF9F0A" stroke-dasharray="138"
                                stroke-dashoffset="30"></circle>
                        </svg>
                    </div>
                    <div class="macro-text_final">
                        <span class="macro-label_final">Calories</span>
                        <input type="number" class="macro-input_final" value="350">
                    </div>
                </div>

                <div class="macro-card_final">
                    <div class="ring-container_final">
                        <span class="ring-emoji_final">üçÇ</span>
                        <svg class="svg-ring_final">
                            <circle class="ring-bg_final" cx="27" cy="27" r="22"></circle>
                            <circle class="ring-fg_final" cx="27" cy="27" r="22" stroke="#FFD60A" stroke-dasharray="138"
                                stroke-dashoffset="40"></circle>
                        </svg>
                    </div>
                    <div class="macro-text_final">
                        <span class="macro-label_final">Carbs</span>
                        <input type="number" class="macro-input_final" value="45">
                    </div>
                </div>

                <div class="macro-card_final">
                    <div class="ring-container_final">
                        <span class="ring-emoji_final">ü•©</span>
                        <svg class="svg-ring_final">
                            <circle class="ring-bg_final" cx="27" cy="27" r="22"></circle>
                            <circle class="ring-fg_final" cx="27" cy="27" r="22" stroke="#FF453A" stroke-dasharray="138"
                                stroke-dashoffset="90"></circle>
                        </svg>
                    </div>
                    <div class="macro-text_final">
                        <span class="macro-label_final">Protein</span>
                        <input type="number" class="macro-input_final" value="10">
                    </div>
                </div>

                <div class="macro-card_final">
                    <div class="ring-container_final">
                        <span class="ring-emoji_final">üíß</span>
                        <svg class="svg-ring_final">
                            <circle class="ring-bg_final" cx="27" cy="27" r="22"></circle>
                            <circle class="ring-fg_final" cx="27" cy="27" r="22" stroke="#0A84FF" stroke-dasharray="138"
                                stroke-dashoffset="60"></circle>
                        </svg>
                    </div>
                    <div class="macro-text_final">
                        <span class="macro-label_final">Fat</span>
                        <input type="number" class="macro-input_final" value="15">
                    </div>
                </div>

                <button class="main-btn" style="margin-top: 20px; background: white; color: black;">Save
                    Changes</button>
            </div>
        </div>
    </div>

    <!-- Subscription Modal -->
    <div id="subscription-modal" class="subscription-modal hidden">
        <div class="subscription-content">
            <!-- Header -->
            <div class="subscription-header">
                <button class="subscription-close" onclick="closeSubscriptionModal()">‚úï</button>
                <h3 class="subscription-title">–ü–æ–¥–ø–∏—Å–∫–∞</h3>
            </div>

            <!-- Main Content -->
            <div class="subscription-body">
                <!-- Hero Section -->
                <div class="subscription-hero">
                    <div class="subscription-icon">
                        <svg width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <defs>
                                <linearGradient id="crystalGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#8B5CF6;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#EC4899;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <path d="M40 5 L60 25 L55 50 L40 75 L25 50 L20 25 Z" fill="url(#crystalGradient)" />
                            <path d="M40 5 L60 25 L40 35 Z" fill="url(#crystalGradient)" opacity="0.6" />
                            <path d="M20 25 L40 35 L25 50 Z" fill="url(#crystalGradient)" opacity="0.4" />
                            <path d="M60 25 L55 50 L40 35 Z" fill="url(#crystalGradient)" opacity="0.5" />
                        </svg>
                    </div>
                    <h1 class="subscription-heading">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ Calorie Premium –±–µ—Å–ø–ª–∞—Ç–Ω–æ</h1>
                </div>

                <!-- Free Plan Card -->
                <div class="plan-card plan-free">
                    <div class="plan-header">
                        <div class="plan-icon-wrapper">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="#007AFF" />
                                <path d="M2 17L12 22L22 17" stroke="#007AFF" stroke-width="2" />
                                <path d="M2 12L12 17L22 12" stroke="#007AFF" stroke-width="2" />
                            </svg>
                        </div>
                        <div class="plan-badge">LITE</div>
                    </div>
                    <div class="plan-price">Free</div>
                    <div class="plan-features">
                        <div class="feature-item">
                            <svg class="feature-check" width="20" height="20" viewBox="0 0 20 20">
                                <circle cx="10" cy="10" r="10" fill="#34C759" />
                                <path d="M6 10L9 13L14 7" stroke="white" stroke-width="2" fill="none" />
                            </svg>
                            <span>Daily calorie logging</span>
                        </div>
                        <div class="feature-item">
                            <svg class="feature-check" width="20" height="20" viewBox="0 0 20 20">
                                <circle cx="10" cy="10" r="10" fill="#34C759" />
                                <path d="M6 10L9 13L14 7" stroke="white" stroke-width="2" fill="none" />
                            </svg>
                            <span>Basic food database</span>
                        </div>
                    </div>
                    <button class="plan-button plan-button-current">Current Plan</button>
                </div>

                <!-- Premium Plan Card -->
                <div class="plan-card plan-premium">
                    <div class="plan-badge-popular">MOST POPULAR</div>
                    <div class="plan-header">
                        <div class="plan-icon-wrapper plan-icon-premium">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <defs>
                                    <linearGradient id="fireGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#FF6B35;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#F7931E;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <path d="M12 2C12 2 8 6 8 10C8 13 10 15 12 15C14 15 16 13 16 10C16 6 12 2 12 2Z"
                                    fill="url(#fireGradient)" />
                                <path
                                    d="M12 15C12 15 10 17 10 19C10 21 11 22 12 22C13 22 14 21 14 19C14 17 12 15 12 15Z"
                                    fill="url(#fireGradient)" opacity="0.7" />
                            </svg>
                        </div>
                        <div class="plan-badge">PREMIUM</div>
                    </div>
                    <div class="plan-price">$9.99<span class="plan-period">/mo</span></div>
                    <div class="plan-features">
                        <div class="feature-item">
                            <svg class="feature-check feature-check-orange" width="20" height="20" viewBox="0 0 20 20">
                                <circle cx="10" cy="10" r="10" fill="#FF9500" />
                                <path d="M6 10L9 13L14 7" stroke="white" stroke-width="2" fill="none" />
                            </svg>
                            <span>Full Macro breakdown</span>
                        </div>
                        <div class="feature-item">
                            <svg class="feature-check feature-check-orange" width="20" height="20" viewBox="0 0 20 20">
                                <circle cx="10" cy="10" r="10" fill="#FF9500" />
                                <path d="M6 10L9 13L14 7" stroke="white" stroke-width="2" fill="none" />
                            </svg>
                            <span>Custom nutrition goals</span>
                        </div>
                        <div class="feature-item">
                            <svg class="feature-check feature-check-orange" width="20" height="20" viewBox="0 0 20 20">
                                <circle cx="10" cy="10" r="10" fill="#FF9500" />
                                <path d="M6 10L9 13L14 7" stroke="white" stroke-width="2" fill="none" />
                            </svg>
                            <span>Barcode scanner</span>
                        </div>
                    </div>
                    <button class="plan-button plan-button-premium">Choose Premium</button>
                </div>

                <!-- Pro Plan Card -->
                <div class="plan-card plan-pro">
                    <div class="plan-header">
                        <div class="plan-icon-wrapper plan-icon-pro">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <defs>
                                    <linearGradient id="boltGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#8B5CF6;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#EC4899;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <path d="M13 2L3 14H12L11 22L21 10H12L13 2Z" fill="url(#boltGradient)" />
                            </svg>
                        </div>
                        <div class="plan-badge">PRO</div>
                    </div>
                    <div class="plan-price">$14.99<span class="plan-period">/mo</span></div>
                    <div class="plan-features">
                        <div class="feature-item">
                            <svg class="feature-check feature-check-purple" width="20" height="20" viewBox="0 0 20 20">
                                <circle cx="10" cy="10" r="10" fill="#8B5CF6" />
                                <path d="M6 10L9 13L14 7" stroke="white" stroke-width="2" fill="none" />
                            </svg>
                            <span>AI Meal Recognition</span>
                        </div>
                        <div class="feature-item">
                            <svg class="feature-check feature-check-purple" width="20" height="20" viewBox="0 0 20 20">
                                <circle cx="10" cy="10" r="10" fill="#8B5CF6" />
                                <path d="M6 10L9 13L14 7" stroke="white" stroke-width="2" fill="none" />
                            </svg>
                            <span>Advanced health reports</span>
                        </div>
                    </div>
                    <button class="plan-button plan-button-pro">Choose Pro</button>
                </div>

                <!-- Footer -->
                <div class="subscription-footer">
                    <p class="subscription-disclaimer">Recurring billing. Cancel anytime. By continuing, you agree to
                        our <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <script src="time-picker.js"></script>
    <script src="script.js?v=999.0"></script>
</body>

</html>